branches:
  except:
    - /travis/
skip_tags: true

cache:
  #- C:\Strawberry

install:
  - if not exist "C:\strawberry" appveyor-retry choco install strawberryperl --version 5.30.2.1
  #- appveyor-retry choco upgrade strawberryperl --version 5.28.1.1
  - set ST=C:\Strawberry
  - set PATH=%ST%\perl\bin;%ST%\perl\site\bin;%ST%\c\bin;%PATH%
  - path
  - cd C:\projects\%APPVEYOR_PROJECT_NAME%
  
  #  aliens should be cached now
  - cpanm --quiet --notest Module::Compile
    
  - cpanm --quiet --notest Alien::Build
  
  - cpanm -v --notest Alien::sqlite
  - cpanm -v --notest Alien::geos::af
  - cpanm -v Alien::libtiff
  - cpanm -v Alien::proj
  
  #- cpanm -v --notest Alien::freexl
  #- cpanm -v --notest Alien::spatialite
  - set ALIEN_GDAL_CONFIG_ARGS=--without-spatialite
  - cpanm -v Alien::gdal
  
  - ppm set repository BDV_PPM http://biodiverse.unsw.edu.au/downloads/ppm
  - ppm install --location http://biodiverse.unsw.edu.au/downloads/ppm PDL
  
  - cpanm FFI::Platypus::Declare
  - cpanm --notest Geo::GDAL::FFI
  - cpanm --notest Sereal
  - cpanm --notest Task::Biodiverse::NoGUI
  - cpanm --notest List::MoreUtils~0.425
  - cpanm --notest List::Unique::DeterministicOrder
  - cpanm --notest Sort::Key::Natural
  - cpanm --notest Win32::LongPath
  - cpanm --notest Geo::ShapeFile@3.00
  - cpanm --notest Browser::Start
  - cpanm --quiet Test2::Suite
  - cpanm --installdeps .


build_script:
  - prove -l
  #- perl -e "1"

